var c=(i,t,s)=>{if(!t.has(i))throw TypeError("Cannot "+s)};var p=(i,t,s)=>{if(t.has(i))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(i):t.set(i,s)};var h=(i,t,s)=>(c(i,t,"access private method"),s);var a,_;class m{constructor(t){p(this,a);this.el=$(t),$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}})}find(t){return this.el.find(t)}values(t){let s={},r=$(t).find("input"),e=$(t).find("textarea"),o=$(t).find("select");return h(this,a,_).call(this,s,r),h(this,a,_).call(this,s,e),h(this,a,_).call(this,s,o),s}get(t,s=()=>{},r=()=>{}){$.get(t).done(e=>s(e)).fail(e=>r(e))}post(t,s=()=>{},r=()=>{}){$.post(t).done(e=>s(e)).fail(e=>r(e))}}a=new WeakSet,_=function(t,s){s&&s.map((r,e)=>{$(e).attr("type")!=="checkbox"&&$(e).attr("type")!=="radio"?t[$(e).attr("name")]=$(e).val():t[$(e).attr("name")]=$(e).prop("checked")})};$(document).ready(()=>{new l("main")});class n extends m{constructor(t){super(t),this.groups_data=null,this.groups=this.find("#groups"),this.category=this.find("#category"),this.apartment=this.find(".apartment"),this.apartment__city=this.find('select[name="apartment__city"]'),this.apartment__district=this.find('select[name="apartment__district"]'),this.apartment__price1=this.apartment.find('input[name="price1"]'),this.apartment__price2=this.apartment.find('input[name="price2"]'),this.apartment__rooms_all=this.find('input[name="all"]'),this.apartment__rooms_one=this.find('input[name="r1"]'),this.apartment__rooms_two=this.find('input[name="r2"]'),this.apartment__rooms_three=this.find('input[name="r3"]'),this.apartment__rooms_four=this.find('input[name="r4"]'),this.apartment__rooms_five=this.find('input[name="r5"]'),this.apartment__form=this.apartment.find("form"),this.apartment__submit=this.apartment.find(".submit"),this.rooms=this.find(".rooms"),this.rooms__city=this.find('select[name="rooms__city"]'),this.rooms__district=this.find('select[name="rooms__district"]'),this.rooms__price1=this.rooms.find('input[name="price1"]'),this.rooms__price2=this.rooms.find('input[name="price2"]'),this.rooms__form=this.rooms.find("form"),this.rooms__submit=this.rooms.find(".submit"),this.request_urls={district:"&search[district_id]=",price1:"&search[filter_float_price:from]=",price2:"&search[filter_float_price:to]=",rooms1:"&search[filter_enum_rooms][0]=one",rooms2:"&search[filter_enum_rooms][1]=two",rooms3:"&search[filter_enum_rooms][2]=three",rooms4:"&search[filter_enum_rooms][3]=four",rooms5:"&search[filter_enum_number_of_rooms_string][4]=pyatikomnatnye",rent_apartment:"https://www.olx.pl/nieruchomosci/mieszkania/wynajem/warszawa/?",rent_rooms:"https://www.olx.pl/nieruchomosci/stancje-pokoje/warszawa/?"},this.current_group=null,this.modal_update=this.find(".modal_update")}}class l extends n{constructor(t){super(t),this.process=new u(t,this),this.server=new d(t,this),this.onload(),this.events()}onload(){this.process.toggle_category(),this.server.get_groups_data(this.process.render_groups.bind(this)),setTimeout(()=>{console.log(this.groups_data)},500)}events(){this.groups.on("change",this.process.on_group_change.bind(this)),this.groups.on("change",()=>{this.process.fill_forms()}),this.category.on("change",()=>{this.process.toggle_category()}),this.apartment__rooms_all.on("change",this.process.toggle_rooms_checkboxes.bind(this)),this.apartment__rooms_one.on("change",this.process.toggle_rooms_checkboxes.bind(this)),this.apartment__rooms_two.on("change",this.process.toggle_rooms_checkboxes.bind(this)),this.apartment__rooms_three.on("change",this.process.toggle_rooms_checkboxes.bind(this)),this.apartment__rooms_four.on("change",this.process.toggle_rooms_checkboxes.bind(this)),this.apartment__rooms_five.on("change",this.process.toggle_rooms_checkboxes.bind(this)),this.apartment__submit.on("click",()=>{this.process.apartment_submit()}),this.rooms__submit.on("click",()=>{this.process.rooms_submit()}),this.modal_update.on("click",()=>{this.modal_update.addClass("filters_hide")})}}class u extends n{constructor(t,s){super(t),this.that=s,this.testing()}toggle_category(){const t=this.category.val();this.apartment.removeClass("flex"),this.rooms.removeClass("flex"),t==="apartment"&&this.apartment.addClass("flex"),t==="rooms"&&this.rooms.addClass("flex")}toggle_rooms_checkboxes(t){$(t.target).attr("name")==="all"&&$(t.target).prop("checked")?(this.apartment__rooms_one.prop("checked",!1),this.apartment__rooms_two.prop("checked",!1),this.apartment__rooms_three.prop("checked",!1),this.apartment__rooms_four.prop("checked",!1),this.apartment__rooms_five.prop("checked",!1)):$(t.target).attr("name")!=="all"&&$(t.target).prop("checked")&&this.apartment__rooms_all.prop("checked",!1)}render_groups(t){t.map((s,r)=>{this.groups.append(`<option value='${s.id}' data-group-id='${s.group_id}'>${s.group_title}</option>`)}),this.groups_data=t}on_group_change(){this.groups.val()===null?(this.apartment.addClass("filters_hide"),this.rooms.addClass("filters_hide")):(this.apartment.removeClass("filters_hide"),this.rooms.removeClass("filters_hide")),this.process.set_current_group_by_id()}apartment_submit(){const t=this.that.values(this.that.apartment__form);let s={rent_type:this.that.category.val(),city:t.apartment__city,district:`${t.apartment__district}`,price:JSON.stringify([t.price1,t.price2]),rooms:JSON.stringify([t.all,t.r1,t.r2,t.r3,t.r4,t.r5]),request_url:this.that.request_urls.rent_apartment+`${this.that.request_urls.district}${t.apartment__district}${t.price1&&this.that.request_urls.price1}${t.price1}${t.price2&&this.that.request_urls.price2}${t.price2}${t.r1?this.that.request_urls.rooms1:""}${t.r2?this.that.request_urls.rooms2:""}${t.r3?this.that.request_urls.rooms3:""}${t.r4?this.that.request_urls.rooms4:""}${t.r5?this.that.request_urls.rooms5:""}`};const r=`${location.origin}/TgGroupsUpdate/${this.that.groups.val()}`;this.that.server.update_group_data(r,s,this.show_message.bind(this))}rooms_submit(){const t=this.that.values(this.that.rooms__form);let s={rent_type:this.that.category.val(),city:t.rooms__city,district:`${t.rooms__district}`,price:JSON.stringify([t.price1,t.price2]),rooms:"",request_url:this.that.request_urls.rent_rooms+`${+t.rooms__district!=0?this.that.request_urls.district:""}${+t.rooms__district!=0?t.rooms__district:""}${t.price1&&this.that.request_urls.price1}${t.price1}${t.price2&&this.that.request_urls.price2}${t.price2}${t.r1?this.that.request_urls.rooms1:""}${t.r2?this.that.request_urls.rooms2:""}${t.r3?this.that.request_urls.rooms3:""}${t.r4?this.that.request_urls.rooms4:""}${t.r5?this.that.request_urls.rooms5:""}`};const r=`${location.origin}/TgGroupsUpdate/${this.that.groups.val()}`;this.that.server.update_group_data(r,s,this.show_message.bind(this))}fill_apartment_form(){this.that.apartment__district.find("option").map((e,o)=>{$(o).val()===this.that.current_group.district?$(o).attr("selected",!0):$(o).attr("selected",!1)}),this.that.apartment__price1.val(JSON.parse(this.that.current_group.price)[0]),this.that.apartment__price2.val(JSON.parse(this.that.current_group.price)[1]);const s=JSON.parse(this.that.current_group.rooms),r=this.that.el.find(".section__apartment_rooms input");s.map((e,o)=>{$(r[o]).prop("checked",e)})}fill_rooms_form(){this.that.rooms__district.find("option").map((s,r)=>{$(r).val()===this.that.current_group.district?$(r).attr("selected",!0):$(r).attr("selected",!1)}),this.that.rooms__price1.val(JSON.parse(this.that.current_group.price)[0]),this.that.rooms__price2.val(JSON.parse(this.that.current_group.price)[1])}fill_forms(){this.that.category.find("option").map((s,r)=>{$(r).val()===this.that.current_group.rent_type?$(r).attr("selected",!0):$(r).attr("selected",!1)}),this.that.current_group.rent_type==="apartment"?this.fill_apartment_form():this.that.current_group.rent_type==="rooms"&&this.fill_rooms_form(),this.toggle_category()}set_current_group_by_id(){this.that.groups_data.map((t,s)=>{+t.id==+this.that.groups.val()&&(this.that.current_group=t)})}show_message(){this.that.modal_update.removeClass("filters_hide"),setTimeout(()=>{this.that.modal_update.addClass("filters_hide")},4100)}testing(){}}class d extends n{constructor(t,s){super(t),this.that=s}get_groups_data(t=()=>{},s=()=>{}){return this.get(`${location.origin}/TgGroupsIndex`,t,s)}update_group_data(t,s,r=()=>{},e=()=>{}){$.post(t,s).fail(o=>{console.log(o)}).done(o=>{console.log(o),r()})}}
